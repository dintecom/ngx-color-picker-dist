import { Color } from './color.class';
import { Subject, BehaviorSubject } from 'rxjs';
import { distinctUntilChanged } from 'rxjs/operators';
import { Rgba } from './rgba.class';
export var ColorType;
(function (ColorType) {
    ColorType["hex"] = "hex";
    ColorType["hexa"] = "hexa";
    ColorType["rgba"] = "rgba";
    ColorType["rgb"] = "rgb";
    ColorType["hsla"] = "hsla";
    ColorType["hsl"] = "hsl";
    ColorType["cmyk"] = "cmyk";
})(ColorType || (ColorType = {}));
export class ColorPickerControl {
    constructor() {
        this.modelValue = null;
        this.hueValue = null;
        this.initValue = null;
        this.valueChanged = new Subject();
        this.presetsVisibilityChanges = new BehaviorSubject(true);
        this.initType = null;
        this.alphaChannelVisibilityChanges = new BehaviorSubject(true);
        this.valueChanges = this.valueChanged.asObservable().pipe(distinctUntilChanged((x, y) => x.toRgbaString() == y.toRgbaString()));
        this.colorPresets = [];
        const color = Color.from(new Rgba(255, 0, 0, 1));
        this.setValue(color);
        this.setHueColor(color);
    }
    setValueFrom(color) {
        const newColor = Color.from(color);
        if (!this.initValue) {
            this.initValue = Color.from(color);
        }
        if (typeof color === 'string') {
            this.finOutInputType(color);
        }
        this.setHueColor(newColor);
        this.setValue(newColor);
        return this;
    }
    setHueColor(color) {
        if (this.hueValue && color.getHsva().hue > 0 || !this.hueValue) {
            this.hueValue = new Color().setHsva(color.getHsva().hue);
        }
    }
    get hue() {
        return this.hueValue;
    }
    /**
     * @internal
     * used for two-way data binding
     */
    set hue(hueColor) {
        this.hueValue = hueColor;
    }
    setValue(value) {
        this.modelValue = value;
        this.valueChanged.next(value);
        return this;
    }
    get value() {
        return this.modelValue;
    }
    /**
     * @internal
     * used for two-way data binding
     */
    set value(value) {
        this.setValue(value);
    }
    /**
     * reset color to initial
     */
    reset() {
        let color;
        if (!this.initValue) {
            color = Color.from(new Rgba(255, 0, 0, 1));
            this.hueValue = new Color().setHsva(color.getHsva().hue);
        }
        else {
            color = this.initValue.clone();
            this.setHueColor(color);
        }
        this.setValue(color);
        return this;
    }
    isAlphaChannelEnabled() {
        return this.alphaChannelVisibilityChanges.value;
    }
    showAlphaChannel() {
        this.alphaChannelVisibilityChanges.next(true);
        return this;
    }
    hideAlphaChannel() {
        this.alphaChannelVisibilityChanges.next(false);
        return this;
    }
    finOutInputType(colorString) {
        const str = colorString.replace(/ /g, '').toLowerCase();
        if (str[0] === '#') {
            this.initType = ColorType.hex;
            if (str.length > 7) {
                this.initType = ColorType.hexa;
            }
        }
        const OpenParenthesis = str.indexOf('(');
        const colorTypeName = str.substr(0, OpenParenthesis);
        switch (colorTypeName) {
            case ColorType.rgba:
                this.initType = ColorType.rgba;
                break;
            case ColorType.rgb:
                this.initType = ColorType.rgb;
                break;
            case ColorType.hsla:
                this.initType = ColorType.hsla;
                break;
            case ColorType.hsl:
                this.initType = ColorType.hsl;
                break;
            case ColorType.cmyk:
                this.initType = ColorType.cmyk;
                break;
        }
    }
    setColorPresets(colorPresets) {
        this.colorPresets = this.setPresets(colorPresets);
        return this;
    }
    setPresets(colorPresets) {
        const presets = [];
        for (const color of colorPresets) {
            if (Array.isArray(color)) {
                presets.push(this.setPresets(color));
            }
            else {
                presets.push(new Color(color));
            }
        }
        return presets;
    }
    get presets() {
        return this.colorPresets;
    }
    hasPresets() {
        return this.colorPresets.length > 0;
    }
    isPresetVisible() {
        return this.presetsVisibilityChanges.value;
    }
    showPresets() {
        this.presetsVisibilityChanges.next(true);
        return this;
    }
    hidePresets() {
        this.presetsVisibilityChanges.next(false);
        return this;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC5jbGFzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lwbGFiL25neC1jb2xvci1waWNrZXIvc3JjL2xpYi9oZWxwZXJzL2NvbnRyb2wuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBZSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBSXBDLE1BQU0sQ0FBTixJQUFZLFNBUVg7QUFSRCxXQUFZLFNBQVM7SUFDakIsd0JBQVcsQ0FBQTtJQUNYLDBCQUFhLENBQUE7SUFDYiwwQkFBYSxDQUFBO0lBQ2Isd0JBQVcsQ0FBQTtJQUNYLDBCQUFhLENBQUE7SUFDYix3QkFBVyxDQUFBO0lBQ1gsMEJBQWEsQ0FBQTtBQUNqQixDQUFDLEVBUlcsU0FBUyxLQUFULFNBQVMsUUFRcEI7QUFFRCxNQUFNLE9BQU8sa0JBQWtCO0lBYzNCO1FBWlEsZUFBVSxHQUFVLElBQUksQ0FBQztRQUN6QixhQUFRLEdBQVUsSUFBSSxDQUFDO1FBQ3ZCLGNBQVMsR0FBVSxJQUFJLENBQUM7UUFDZixpQkFBWSxHQUFtQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBRTlDLDZCQUF3QixHQUE2QixJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RixhQUFRLEdBQWMsSUFBSSxDQUFDO1FBQ2xCLGtDQUE2QixHQUE2QixJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwRixpQkFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMs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QyxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRU0sV0FBVztRQUNkLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUMsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29sb3IsIENvbG9yU3RyaW5nIH0gZnJvbSAnLi9jb2xvci5jbGFzcyc7XG5pbXBvcnQgeyBTdWJqZWN0LCBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUmdiYSB9IGZyb20gJy4vcmdiYS5jbGFzcyc7XG5pbXBvcnQgeyBIc2xhIH0gZnJvbSAnLi9oc2xhLmNsYXNzJztcbmltcG9ydCB7IEhzdmEgfSBmcm9tICcuL2hzdmEuY2xhc3MnO1xuXG5leHBvcnQgZW51bSBDb2xvclR5cGUge1xuICAgIGhleCA9ICdoZXgnLFxuICAgIGhleGEgPSAnaGV4YScsXG4gICAgcmdiYSA9ICdyZ2JhJyxcbiAgICByZ2IgPSAncmdiJyxcbiAgICBoc2xhID0gJ2hzbGEnLFxuICAgIGhzbCA9ICdoc2wnLFxuICAgIGNteWsgPSAnY215aydcbn1cblxuZXhwb3J0IGNsYXNzIENvbG9yUGlja2VyQ29udHJvbCB7XG5cbiAgICBwcml2YXRlIG1vZGVsVmFsdWU6IENvbG9yID0gbnVsbDtcbiAgICBwcml2YXRlIGh1ZVZhbHVlOiBDb2xvciA9IG51bGw7XG4gICAgcHJpdmF0ZSBpbml0VmFsdWU6IENvbG9yID0gbnVsbDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHZhbHVlQ2hhbmdlZDogU3ViamVjdDxDb2xvcj4gPSBuZXcgU3ViamVjdCgpO1xuXG4gICAgcHVibGljIHJlYWRvbmx5IHByZXNldHNWaXNpYmlsaXR5Q2hhbmdlczogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdCh0cnVlKTtcbiAgICBwdWJsaWMgaW5pdFR5cGU6IENvbG9yVHlwZSA9IG51bGw7XG4gICAgcHVibGljIHJlYWRvbmx5IGFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHRydWUpO1xuICAgIHB1YmxpYyByZWFkb25seSB2YWx1ZUNoYW5nZXMgPSB0aGlzLnZhbHVlQ2hhbmdlZC5hc09ic2VydmFibGUoKS5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCh4LCB5KSA9PiB4LnRvUmdiYVN0cmluZygpID09IHkudG9SZ2JhU3RyaW5nKCkpKTtcblxuICAgIHByaXZhdGUgY29sb3JQcmVzZXRzOiBBcnJheTxBcnJheTxDb2xvcj4gfCBDb2xvcj4gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBjb25zdCBjb2xvciA9IENvbG9yLmZyb20obmV3IFJnYmEoMjU1LCAwLCAwLCAxKSk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUoY29sb3IpO1xuICAgICAgICB0aGlzLnNldEh1ZUNvbG9yKGNvbG9yKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0VmFsdWVGcm9tKGNvbG9yOiBDb2xvclN0cmluZyB8IENvbG9yIHwgUmdiYSB8IEhzbGEgfCBIc3ZhKTogdGhpcyB7XG4gICAgICAgIGNvbnN0IG5ld0NvbG9yID0gQ29sb3IuZnJvbShjb2xvcik7XG4gICAgICAgIGlmICghdGhpcy5pbml0VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdFZhbHVlID0gQ29sb3IuZnJvbShjb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGNvbG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpcy5maW5PdXRJbnB1dFR5cGUoY29sb3IpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0SHVlQ29sb3IobmV3Q29sb3IpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKG5ld0NvbG9yKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRIdWVDb2xvcihjb2xvcjogQ29sb3IpIHtcbiAgICAgICAgaWYgKHRoaXMuaHVlVmFsdWUgJiYgY29sb3IuZ2V0SHN2YSgpLmh1ZSA+IDAgfHwgIXRoaXMuaHVlVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuaHVlVmFsdWUgPSBuZXcgQ29sb3IoKS5zZXRIc3ZhKGNvbG9yLmdldEhzdmEoKS5odWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBodWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh1ZVZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIHVzZWQgZm9yIHR3by13YXkgZGF0YSBiaW5kaW5nXG4gICAgICovXG4gICAgcHVibGljIHNldCBodWUoaHVlQ29sb3I6IENvbG9yKSB7XG4gICAgICAgIHRoaXMuaHVlVmFsdWUgPSBodWVDb2xvcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFZhbHVlKHZhbHVlOiBDb2xvcik6IHRoaXMge1xuICAgICAgICB0aGlzLm1vZGVsVmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZWQubmV4dCh2YWx1ZSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgdmFsdWUoKTogQ29sb3Ige1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbFZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIHVzZWQgZm9yIHR3by13YXkgZGF0YSBiaW5kaW5nXG4gICAgICovXG4gICAgcHVibGljIHNldCB2YWx1ZSh2YWx1ZTogQ29sb3IpIHtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmVzZXQgY29sb3IgdG8gaW5pdGlhbFxuICAgICAqL1xuICAgIHB1YmxpYyByZXNldCgpOiB0aGlzIHtcbiAgICAgICAgbGV0IGNvbG9yO1xuICAgICAgICBpZiAoIXRoaXMuaW5pdFZhbHVlKSB7XG4gICAgICAgICAgICBjb2xvciA9IENvbG9yLmZyb20obmV3IFJnYmEoMjU1LCAwLCAwLCAxKSk7XG4gICAgICAgICAgICB0aGlzLmh1ZVZhbHVlID0gbmV3IENvbG9yKCkuc2V0SHN2YShjb2xvci5nZXRIc3ZhKCkuaHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbG9yID0gdGhpcy5pbml0VmFsdWUuY2xvbmUoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0SHVlQ29sb3IoY29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRWYWx1ZShjb2xvcik7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHB1YmxpYyBpc0FscGhhQ2hhbm5lbEVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzLnZhbHVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaG93QWxwaGFDaGFubmVsKCk6IHRoaXMge1xuICAgICAgICB0aGlzLmFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzLm5leHQodHJ1ZSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHB1YmxpYyBoaWRlQWxwaGFDaGFubmVsKCk6IHRoaXMge1xuICAgICAgICB0aGlzLmFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzLm5leHQoZmFsc2UpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbk91dElucHV0VHlwZShjb2xvclN0cmluZzogQ29sb3JTdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgc3RyID0gY29sb3JTdHJpbmcucmVwbGFjZSgvIC9nLCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKHN0clswXSA9PT0gJyMnKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLmhleDtcbiAgICAgICAgICAgIGlmIChzdHIubGVuZ3RoID4gNykge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUuaGV4YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IE9wZW5QYXJlbnRoZXNpcyA9IHN0ci5pbmRleE9mKCcoJyk7XG4gICAgICAgIGNvbnN0IGNvbG9yVHlwZU5hbWUgPSBzdHIuc3Vic3RyKDAsIE9wZW5QYXJlbnRoZXNpcyk7XG4gICAgICAgIHN3aXRjaCAoY29sb3JUeXBlTmFtZSkge1xuICAgICAgICAgICAgY2FzZSBDb2xvclR5cGUucmdiYTpcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLnJnYmE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENvbG9yVHlwZS5yZ2I6XG4gICAgICAgICAgICAgICAgdGhpcy5pbml0VHlwZSA9IENvbG9yVHlwZS5yZ2I7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENvbG9yVHlwZS5oc2xhOlxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUuaHNsYTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQ29sb3JUeXBlLmhzbDpcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLmhzbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQ29sb3JUeXBlLmNteWs6XG4gICAgICAgICAgICAgICAgdGhpcy5pbml0VHlwZSA9IENvbG9yVHlwZS5jbXlrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHNldENvbG9yUHJlc2V0cyhjb2xvclByZXNldHM6IEFycmF5PEFycmF5PENvbG9yU3RyaW5nPiB8IENvbG9yU3RyaW5nPik6IHRoaXMge1xuICAgICAgICB0aGlzLmNvbG9yUHJlc2V0cyA9IHRoaXMuc2V0UHJlc2V0cyhjb2xvclByZXNldHMpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFByZXNldHMoY29sb3JQcmVzZXRzOiBBcnJheTxBcnJheTxDb2xvclN0cmluZz4gfCBDb2xvclN0cmluZz4pOiBBcnJheTxDb2xvcj4ge1xuICAgICAgICBjb25zdCBwcmVzZXRzID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiBjb2xvclByZXNldHMpIHtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbG9yKSkge1xuICAgICAgICAgICAgICAgIHByZXNldHMucHVzaCh0aGlzLnNldFByZXNldHMoY29sb3IpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJlc2V0cy5wdXNoKG5ldyBDb2xvcihjb2xvcikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcmVzZXRzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgcHJlc2V0cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3JQcmVzZXRzO1xuICAgIH1cblxuICAgIHB1YmxpYyBoYXNQcmVzZXRzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xvclByZXNldHMubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNQcmVzZXRWaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmVzZXRzVmlzaWJpbGl0eUNoYW5nZXMudmFsdWU7XG4gICAgfVxuXG4gICAgcHVibGljIHNob3dQcmVzZXRzKCk6IHRoaXMge1xuICAgICAgICB0aGlzLnByZXNldHNWaXNpYmlsaXR5Q2hhbmdlcy5uZXh0KHRydWUpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBwdWJsaWMgaGlkZVByZXNldHMoKTogdGhpcyB7XG4gICAgICAgIHRoaXMucHJlc2V0c1Zpc2liaWxpdHlDaGFuZ2VzLm5leHQoZmFsc2UpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG4iXX0=